<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.lug.ustc.edu.cn/css?family=Nunito:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="本篇主要是介绍一些背景和趋势以及笔者自己的思考，不涉及技术细节。 为什么需要插件化插件化框架发展至今已经有六、七年的历史了，在当今技术日新月异的年代，算是已经淬炼了很久了，作为 Android 的开发者应该多多少少都听说过插件化。那么它为什么会诞生？或者说插件化是要解决什么问题呢？ 可能有人会注意到一件有趣的事情，向来 Geek 的外国开发者好像对插件化并不怎么感兴趣，这样一套庞大的黑科技框架似乎">
<meta property="og:type" content="article">
<meta property="og:title" content="插件化的过去、现在与未来">
<meta property="og:url" content="http://zeatual.com/2018/08/02/plugin-framework-preface/index.html">
<meta property="og:site_name" content="Blog">
<meta property="og:description" content="本篇主要是介绍一些背景和趋势以及笔者自己的思考，不涉及技术细节。 为什么需要插件化插件化框架发展至今已经有六、七年的历史了，在当今技术日新月异的年代，算是已经淬炼了很久了，作为 Android 的开发者应该多多少少都听说过插件化。那么它为什么会诞生？或者说插件化是要解决什么问题呢？ 可能有人会注意到一件有趣的事情，向来 Geek 的外国开发者好像对插件化并不怎么感兴趣，这样一套庞大的黑科技框架似乎">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2018-08-02T08:20:29.400Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="插件化的过去、现在与未来">
<meta name="twitter:description" content="本篇主要是介绍一些背景和趋势以及笔者自己的思考，不涉及技术细节。 为什么需要插件化插件化框架发展至今已经有六、七年的历史了，在当今技术日新月异的年代，算是已经淬炼了很久了，作为 Android 的开发者应该多多少少都听说过插件化。那么它为什么会诞生？或者说插件化是要解决什么问题呢？ 可能有人会注意到一件有趣的事情，向来 Geek 的外国开发者好像对插件化并不怎么感兴趣，这样一套庞大的黑科技框架似乎">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://zeatual.com/2018/08/02/plugin-framework-preface/"/>





  <title>插件化的过去、现在与未来 | Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://zeatual.com/2018/08/02/plugin-framework-preface/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zeatual">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">插件化的过去、现在与未来</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-02T00:00:00+08:00">
                2018-08-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>本篇主要是介绍一些背景和趋势以及笔者自己的思考，不涉及技术细节。</p>
<h2 id="为什么需要插件化"><a href="#为什么需要插件化" class="headerlink" title="为什么需要插件化"></a>为什么需要插件化</h2><p>插件化框架发展至今已经有六、七年的历史了，在当今技术日新月异的年代，算是已经淬炼了很久了，作为 Android 的开发者应该多多少少都听说过插件化。那么它为什么会诞生？或者说插件化是要解决什么问题呢？</p>
<p>可能有人会注意到一件有趣的事情，向来 Geek 的外国开发者好像对插件化并不怎么感兴趣，这样一套庞大的黑科技框架似乎只在国内被各大厂追捧。笔者觉得这与国内外的产品形态差异有关。老外总是喜欢做小而美的东西，总要与人不同。而在中国大家都喜欢大而全的万能平台，无论是用户还是企业都喜爱一站式服务的解决方案。也正是这样的原因，导致了国内的产品都很大，尤其在移动端这样轻量化的平台，软硬件迭代的速度跟不上迅速膨胀的业务需求。不信你打开淘宝，携程，美团众多 app 看一下，琳琅满目的各种频道铺满首页，模块与模块间的依赖错综复杂，项目体积早已爆炸，一个业务团队动辄上百人。随着项目的庞大，编译速度问题，庞大系统的健壮性问题，协作问题等等成为了企业增长的瓶颈。也正是在这样的背景下，催生了插件化这个中国特色产物。</p>
<h2 id="插件化是什么"><a href="#插件化是什么" class="headerlink" title="插件化是什么"></a>插件化是什么</h2><p>插件化框架其实是一组黑科技的聚合，最核心的诉求就是能够动态加载 APK，通俗来讲就是在 app 安装以后，能够在运行时加载其他 APK 中的代码。这样一来，只要将项目模块间的解耦做好，把各个模块打包成不同的 APK，用户在使用时，只需要安装主 app，而其他模块 APK 存放于服务端，然后在主 app 中使用时按需求去加载对应的功能 APK。一来解决了协作问题，不同的团队可以单独维护不同的模块，甚至是项目级别的代码隔离；二来由于功能模块是动态加载，就意味着可以动态更新，从而实现热更新，同时也减小了 app 体积，提升了一定用户体验。</p>
<p>由此可见，插件化的核心就是如何实现动态加载 APK。说起来简单，那么动态加载 APK 所带来的问题又是什么呢？</p>
<ul>
<li>我们首先要解决的是如何加载 APK 当中代码的问题。我们知道，在 JVM 上是通过<code>ClassLoader</code>来加载编译过的<code>.class</code>文件，那么这里就要搞清楚 Android 系统是如何使用 ClassLoader 来运行的。</li>
<li>加载好代码，还有就是资源文件的加载。Android 使用<code>AssetManager</code>来管理资源文件（图片、布局文件、主题、颜色、文字等等），就算能够加载，这里还要考虑到资源冲突和资源共享的问题。</li>
<li>代码和资源都加载好了，但由于不同的 APK 是运行在不同的进程中的，如果主应用需要和模块应用或者说插件之间交互通信，就又涉及到了跨进程通信的问题，Android 系统本身的各种系统 Service 和 Activity 的启动过程都涉及到了跨进程通信的问题，这就又需要深入到系统底层，弄清楚 Binder 机制到底是怎么回事。</li>
<li>由于以上问题都涉及到需要使用反射对 framework 层进行 hack，而在国内各种厂家定制 Rom 的背景下，就产生了大量的兼容性问题，而这也是导致插件化框架不稳定最大的原因。要解决这个问题没有捷径，只能一个一个坑踩过去。</li>
<li>最后，解决了所有技术上的问题，还剩下工程运维的问题需要解决，新的项目架构需要新的打包方式，服务端维护的插件模块也需要对应的部署、更新策略。</li>
</ul>
<p>我将在后续的系列文章对以上问题分别进行详细地介绍。</p>
<h2 id="现状"><a href="#现状" class="headerlink" title="现状"></a>现状</h2><p>插件化发展到现在，众多大厂已经分分推出了自己的插件化框架阿里的<a href="https://github.com/alibaba/atlas" target="_blank" rel="noopener">Atlas</a>，360的<a href="https://github.com/Qihoo360/RePlugin" target="_blank" rel="noopener">RePlugin</a>，滴滴的<a href="https://github.com/didi/VirtualAPK" target="_blank" rel="noopener">VirtualAPK</a>等等。在处理上述所涉及到的问题时，每家的方案都有异同点，也因此各有各的优劣势。并不能说哪一个是更好的，只能说他们各自都是最适合自己业务场景的产物，这也给了其他开发者选择框架时的参考，插件化框架一定要与自己项目的业务场景相结合，并不是越万能越好。具体方案间的对比可以参考这篇文章<a href="http://dim.red/2018/03/31/plugin_framework_%20exploration/" target="_blank" rel="noopener">插件化方案对比 · dim’s blog</a>。</p>
<h2 id="随想"><a href="#随想" class="headerlink" title="随想"></a>随想</h2><p>插件化走过了百花齐放的阶段，沉淀到今天，可以说已经相当成熟了。但是要知道，无论是 Google Play 还是 Apple Store 其实都是不允许 app 热更新的，因为这样就能绕过商店的审核机制了。而且就在今年的 Google I/O 大会上，Google 宣布将要禁止对非 SDK 接口即隐藏 API 的访问。虽然禁止方案分为 浅灰名单，深灰名单和黑名单，但趋势一定是向着禁止 hook 修改系统 API 的方向发展的。黑科技对于技术爱好者来说自然是向往的，但也正是这种破坏生态的行为让很多人不愿意使用。无独有偶，今年 Google 还同时推出了 App Bundle，看起来就是官方的插件化解决方案，而且插件是托管在 Google Play 上的，现在还处于测试阶段，其稳定性有待验证。联想到前面禁止非官方 SDK 接口访问的情况，Google 的布局和其用意不禁令人深思。</p>
<p>我觉得插件化框架由商店平台提供绝对是正确的方向，相当于提供了标准化的方案提升用户体验，同时也提升了开发体验。这样的方案本应由商店提供，而不是 app 的开发者。但说到应用商店，国内险恶的环境又不禁令人唏嘘。哪怕国内的商店们纷纷提供这样的能力，会不会又会像推送方案一样让人头疼不已，想到前几年昙花一现的统一推送联盟，现在声音都没了，着实令人心寒。</p>
<p>那身处技术发展过程中的开发者们应该如何选择呢？无论如何插件化所要解决的问题是客观存在的，我觉得有这么几种可能：</p>
<ol>
<li>放弃黑科技，采用组件化思路另辟蹊径。</li>
<li>在黑科技的道路上一黑到底，上有政策下有对策。<a href="http://weishu.me/2018/06/07/free-reflection-above-android-p/" target="_blank" rel="noopener">一种绕过Android P对非SDK接口限制的简单方法 | Weishu’s Notes</a></li>
<li>大 Google 重返中国，统一 Android 生态（太阳从西边出来了，虽然可能性极低，但却是我最想看到的，我相信我不是一个人）。</li>
</ol>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2015/12/08/against-the-current/" rel="next" title="Against The Current">
                <i class="fa fa-chevron-left"></i> Against The Current
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Zeatual</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#为什么需要插件化"><span class="nav-number">1.</span> <span class="nav-text">为什么需要插件化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#插件化是什么"><span class="nav-number">2.</span> <span class="nav-text">插件化是什么</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#现状"><span class="nav-number">3.</span> <span class="nav-text">现状</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#随想"><span class="nav-number">4.</span> <span class="nav-text">随想</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zeatual</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
